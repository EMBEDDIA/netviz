var netviz={nodes:void 0,edges:void 0,network:void 0,isFrozen:!1};function scale(){$("#networkView").height(verge.viewportH()-70),$("#networkView").width($("#networkViewContainer").width()),$("#nodedata").height(verge.viewportH()-180)}function fill_sample(){var e=["node1, term_node2, ->, first edge, Some info text for this edge.","node1, node3, --, second edge, Some more text for this edge.","node1, node4, <-, third edge","term_node2, node4, <->, fourth edge","","node1, This is some text for node1.","term_node2, This is some text for node2."].join("\n");$("#nodedata").val(e)}function make_tooltip(e,t){var n=['<div class="card text-wrap" style="width: 25rem;">','<div class="card-body">','<h5 class="card-title">%s</h5>','<p class="card-text">%s</p>',"</div></div>"].join("");return vsprintf(n,[e,t])}function releaseFreezeBtn(){1==eval($("#freezeBtn").attr("aria-pressed"))&&$("#freezeBtn").click()}function freezeNodes(n){netviz.network.stopSimulation(),netviz.nodes.forEach(function(e,t){netviz.nodes.update({id:t,fixed:n})}),netviz.network.startSimulation()}function freeze(){$(this).hasClass("active")?(freezeNodes(netviz.isFrozen=!1),$(this).text("freeze")):(freezeNodes(netviz.isFrozen=!0),$(this).text("release"))}function clear(){null!=netviz.network&&$("#myModal").text()&&($("#myModal").text(""),$("#myModal").dialog("close"))}function draw_graph(){releaseFreezeBtn(),clear();var e=Papa.parse($("#nodedata").val(),{skipEmptyLines:!0});netviz.nodes=new vis.DataSet,netviz.edges=new vis.DataSet,e.data.forEach(function(e,t,n){if(4<=e.length){var o=e[0].trim(),i=e[1].trim(),a=e[2].trim(),r=e[3].trim(),l=o;-1!=(d=o.indexOf("_"))&&(l=o.slice(d+1)+"\n"+o.slice(0,d));var d,s=i;-1!=(d=i.indexOf("_"))&&(s=i.slice(d+1)+"\n"+i.slice(0,d));var c="";c="->"==a?"to":"<-"==a?"from":"<->"==a?"from,to":"",netviz.nodes.update({id:o,label:l,title:make_tooltip(o,"")}),netviz.nodes.update({id:i,label:s,title:make_tooltip(i,"")}),5<=e.length?netviz.edges.add({id:t,from:o,to:i,label:r,arrows:c,title:make_tooltip("",e[4].trim())}):netviz.edges.add({id:t,from:o,to:i,label:r,arrows:c})}else if(2==e.length){var v=e[0].trim(),p=e[1].trim();netviz.nodes.update({id:v,title:make_tooltip(v,p)})}});var t=document.getElementById("networkView"),n={nodes:netviz.nodes,edges:netviz.edges};netviz.network=new vis.Network(t,n,netviz.options),netviz.network.on("dragStart",onDragStart),netviz.network.on("dragEnd",onDragEnd),netviz.network.on("stabilizationProgress",function(e){netviz.network.redraw()})}function onDragStart(e){if(e.hasOwnProperty("nodes")&&1==e.nodes.length){var t=e.nodes[0];netviz.nodes.update({id:t,fixed:!1})}}function onDragEnd(e){if(0!=netviz.isFrozen){var t=e.nodes;if(e.hasOwnProperty("nodes")&&1==e.nodes.length){t=e.nodes[0];netviz.nodes.update({id:t,fixed:!0})}}}function filterSettings(e,t){return-1!==t.indexOf("physics")?-1!==["gravitationalConstant","centralGravity","springLength","springConstant","damping","avoidOverlap","solver"].indexOf(e):-1!==t.indexOf("edges")&&(-1!==t.indexOf("smooth")&&-1!==["type"].indexOf(e))}function showSettings(){$("#myModal").dialog("open");var e={configure:{enabled:!0,container:document.getElementById("myModal"),filter:filterSettings,showButton:!1}};netviz.network.setOptions(e)}function loadCSV(e){$("#myModal").dialog("close");var t=e.target.files[0];if(t){var n=new FileReader;n.readAsText(t),n.onload=function(e){$("#nodedata").val(e.target.result)},n.onerror=function(){vex.dialog.alert("Error while reading "+t.fileName)};var o=e.target.files[0].name;25<o.length&&(o=o.slice(0,25)+"..."),$("#flab2").text(o)}}function createSettingsDialog(){$("#myModal").dialog({position:"left top",width:"350px",buttons:[{text:"close",click:function(){$(this).dialog("close")}}]})}netviz.options={clickToUse:!1,interaction:{navigationButtons:!0,hover:!0,multiselect:!0,tooltipDelay:1e3},manipulation:{enabled:!0,addNode:function(t,n){vex.dialog.open({message:"Enter node data:",input:['<div class="vex-custom-field-wrapper">','<label for="label">Node label</label>','<div class="vex-custom-input-wrapper">','<input name="label" type="text"/>',"</div>","</div>",'<div class="vex-custom-field-wrapper">','<label for="text">Node text data</label>','<div class="vex-custom-input-wrapper">','<input name="text" type="text"/>',"</div>","</div>"].join(""),callback:function(e){e&&(null==e.text&&(e.text=""),t.label=e.label,t.title=make_tooltip(e.label,e.text),n(t))}})},addEdge:function(t,n){vex.dialog.open({message:"Configure edge",input:['<div class="vex-custom-field-wrapper">','<label for="label">Edge label</label>','<div class="vex-custom-input-wrapper">','<input name="label" type="text"/>',"</div>","</div>",'<div class="vex-custom-field-wrapper">','<label for="text">Edge text data</label>','<div class="vex-custom-input-wrapper">','<input name="text" type="text"/>',"</div>","</div>",'<div class="vex-custom-field-wrapper">','<div class="vex-custom-input-wrapper">','<label for="arrows">Arrows</label>','<select name="arrows" class="custom-select">','<option value="to">to</option>','<option value="from">from</option>','<option value="from,to">from,to</option>','<option value="">none</option>',"</select> ","</div>","</div>"].join(""),callback:function(e){e&&(t.label=e.label,t.title=make_tooltip("",e.text),t.arrows=e.arrows,n(t))}})}},nodes:{font:{size:14,face:"sans"},shape:"box",color:{background:"#C8D7FF",highlight:{border:"red",background:"orange"},hover:{background:"orange"}}},edges:{smooth:{enabled:!0,type:"continuous",forceDirection:"none"},font:{size:13,face:"sans",align:"horizontal",color:"#808080"},color:"#2B7CE9"},layout:{improvedLayout:!1},physics:{enabled:!0,solver:"barnesHut",barnesHut:{gravitationalConstant:-18e3,centralGravity:.1,springLength:150,springConstant:.16},repulsion:{centralGravity:0,springLength:150,springConstant:.05,nodeDistance:170,damping:.1},stabilization:{enabled:!0,iterations:10,fit:!0}}},$(window).resize(function(){scale()}),$(document).ready(function(){$("#drawGraphButton").click(draw_graph),$("#freezeBtn").click(freeze),$("#configButton").click(showSettings),$(document).on("change","#csvfileupload",loadCSV),createSettingsDialog(),$("#myModal").dialog("close"),scale(),fill_sample(),draw_graph()});
